#!/usr/bin/env bash

rm -f CMakeCache.txt

FORTRAN_COMPILER=mpif90

FORTRAN_LIBS=-lgfortran

GOMA_LIBS=/home/goma/production/gcc_4.8.3_openmpi_1.6.4

export MPI_BASE_DIR=/opt/Modules/gcc/4.8.3/openmpi-1.6.4

# Have to set this to get TRY_RUN(...) commands to work
export LD_LIBRARY_PATH=$MPI_BASE_DIR/lib:$LD_LIBRARY_PATH

MPI_LIBS="-LMPI_BASE_DIR/lib -lmpi"
# Install directory
TRILINOS_INSTALL=$GOMA_LIBS/trilinos-11.12.1-stratimikos

cmake \
-D CMAKE_AR=/usr/bin/ar \
-D CMAKE_RANLIB=/usr/bin/ranlib \
-D CMAKE_BUILD_TYPE:STRING=RELEASE \
-D CMAKE_CXX_COMPILER:FILEPATH=$MPI_BASE_DIR/bin/mpiCC \
-D CMAKE_C_COMPILER:FILEPATH=$MPI_BASE_DIR/bin/mpicc \
-D CMAKE_Fortran_COMPILER:FILEPATH=$MPI_BASE_DIR/bin/mpif90 \
-D CMAKE_VERBOSE_MAKEFILE:BOOL=TRUE \
-D Trilinos_ENABLE_Triutils:BOOL=ON \
-D Trilinos_ENABLE_Amesos:BOOL=ON \
-D Trilinos_ENABLE_Epetra:BOOL=ON \
-D Trilinos_ENABLE_Ifpack:BOOL=ON \
-D Trilinos_ENABLE_Teuchos:BOOL=ON \
-D Trilinos_ENABLE_ML:BOOL=ON \
-D Trilinos_ENABLE_AztecOO:BOOL=ON \
-D Trilinos_ENABLE_Belos:BOOL=ON \
    -D Trilinos_ENABLE_Sacado:BOOL=ON \
    -D Trilinos_ENABLE_Epetra:BOOL=ON \
    -D Trilinos_ENABLE_EpetraExt:BOOL=ON \
        -D Trilinos_ENABLE_Thyra:BOOL=ON \
    -D Trilinos_ENABLE_ThyraTpetraAdapters:BOOL=ON \
        -D Trilinos_ENABLE_Tpetra:BOOL=ON \
-D Trilinos_ENABLE_Stratimikos:BOOL=ON \
-D Trilinos_ENABLE_TESTS:BOOL=ON \
-D Trilinos_ENABLE_EXPLICIT_INSTANTIATION:BOOL=ON \
-D TPL_ENABLE_MPI:BOOL=ON \
  -D MPI_COMPILER:FILEPATH=$MPI_BASE_DIR/bin/mpiCC \
  -D MPI_EXECUTABLE:FILEPATH=$MPI_BASE_DIR/bin/mpirun \
  -D MPI_BASE_DIR:PATH=$MPI_BASE_DIR \
-D EpetraExt_BUILD_GRAPH_REORDERINGS:BOOL=ON \
-D EpetraExt_BUILD_BDF:BOOL=ON \
-D TPL_ENABLE_Boost:BOOL=OFF \
-D TPL_ENABLE_LAPACK:BOOL=ON \
-D LAPACK_LIBRARY_DIRS=$GOMA_LIBS/lapack-3.2.1 \
-D LAPACK_LIBRARY_NAMES="lapack" \
-D TPL_ENABLE_BLAS:BOOL=ON \
-D BLAS_LIBRARY_DIRS=$GOMA_LIBS/BLAS \
-D BLAS_LIBRARY_NAMES="blas" \
-D CMAKE_INSTALL_PREFIX:PATH=$TRILINOS_INSTALL \
-D Trilinos_EXTRA_LINK_FLAGS:STRING="$FORTRAN_LIBS;$MPI_LIBS" \
-D TPL_ENABLE_UMFPACK:BOOL=ON \
  -D UMFPACK_LIBRARY_NAMES:STRING="umfpack;amd" \
  -D UMFPACK_LIBRARY_DIRS:PATH=$GOMA_LIBS/UMFPACK-5.4/Lib \
  -D UMFPACK_INCLUDE_DIRS:PATH=$GOMA_LIBS/UMFPACK-5.4/Include \
-D TPL_ENABLE_AMD:BOOL=ON \
  -D AMD_LIBRARY_NAMES:STRING="amd" \
  -D AMD_LIBRARY_DIRS:PATH=$GOMA_LIBS/UMFPACK-5.4/Lib \
  -D AMD_INCLUDE_DIRS:PATH=$GOMA_LIBS/UMFPACK-5.4/Include \
-D TPL_ENABLE_SuperLUDist:BOOL=ON \
  -D SuperLUDist_LIBRARY_NAMES:STRING="superludist" \
  -D SuperLUDist_LIBRARY_DIRS:PATH=$GOMA_LIBS/SuperLU_DIST_2.3/lib \
  -D SuperLUDist_INCLUDE_DIRS:PATH=$GOMA_LIBS/SuperLU_DIST_2.3/SRC \
-D TPL_ENABLE_ParMETIS:BOOL=ON \
  -D ParMETIS_LIBRARY_DIRS:PATH=$GOMA_LIBS/ParMetis-3.1.1\
  -D ParMETIS_INCLUDE_DIRS:PATH=$GOMA_LIBS/ParMetis-3.1.1 \
  -D TPL_ParMETIS_INCLUDE_DIRS:PATH=$GOMA_LIBS/ParMetis-3.1.1 \
  -D TPL_ENABLE_y12m:BOOL=ON \
  -D y12m_LIBRARY_NAMES:STRING="y12m" \
  -D y12m_LIBRARY_DIRS:PATH=$GOMA_LIBS/y12m \
-D TPL_ENABLE_MUMPS:BOOL=ON \
  -D MUMPS_LIBRARY_NAMES:STRING="dmumps;mumps_common;pord" \
  -D MUMPS_LIBRARY_DIRS:PATH=$GOMA_LIBS/MUMPS_4.10.0/lib \
  -D MUMPS_INCLUDE_DIRS:PATH=$GOMA_LIBS/MUMPS_4.10.0/include \
  -D CMAKE_CXX_FLAGS:STRING="-DMUMPS_4_9" \
  -D Amesos_ENABLE_SCALAPACK:BOOL=ON \
  -D SCALAPACK_INCLUDE_DIRS:FILEPATH="$GOMA_LIBS/scalapack-2.0.2/SRC" \
  -D SCALAPACK_LIBRARY_DIRS:FILEPATH="$GOMA_LIBS/scalapack-2.0.2" \
  -D SCALAPACK_LIBRARY_NAMES:STRING="scalapack" \
-D Amesos_ENABLE_SuperLUDist:BOOL=on \
-D Amesos_ENABLE_ParMETIS:BOOL=on \
-D Amesos_ENABLE_LAPACK:BOOL=ON \
-D Amesos_ENABLE_KLU:BOOL=ON \
-D Amesos_ENABLE_UMFPACK:BOOL=ON \
-D Amesos_ENABLE_MUMPS:BOOL=ON \
$EXTRA_ARGS \
..
